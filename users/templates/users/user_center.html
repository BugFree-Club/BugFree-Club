{% extends 'users/base.html' %}

{% block user_info %}
    <h2>个人信息</h2>
    <p>用户名：{{ user_info }}</p>
    <p>头像：</p><img src="{{ user_info.image.url }}" alt="用户头像" height="100px" width="auto">
    <p>地址：{{ user_info.get_address_display|default:'未填' }}</p>
    <p>邮箱：{{ user_info.email }}</p>
    <p>学院：{{ user_info.get_department_display }}</p>
    <p>性别：{{ user_info.get_gender_display|default:'未填' }}</p>



    {% if user.id == user_info.id %}
    <a href="">修改个人信息（弹窗ajax）</a>
        <a href="{% url 'forget' %}">修改密码</a>
        <a href="{% url 'logout' %}">注销用户</a>
       <form id="user-form" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ user_info_form.non_field_errors }}
                    {% for field in user_info_form %}
                        {{ field.label_tag }}
                        {{ field }}
                        {{ field.errors }}
                        {% if field.help_text %}
                            <p class="help text-small text-muted">{{ field.help_text|safe }}</p>
                        {% endif %}
                    {% endfor %}
                    {% if err_msg %}
                        <p class="errorlist">{{ err_msg }}</p>
                    {% endif %}
                        <button id="info-button" type="button" class="btn btn-primary btn-block">提交</button>
                </form>


        <script>
        {#修改个人信息#}
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}' }
        });//切记django的ajax使用post需要加上这个参数 否则csrf验证过不了
        $("#info-button").click(function () {
            $.ajax({
                type: "POST",
                url:'{% url 'user_info' user_id %}',
                data:$('#user-form').serialize(),
                error: function(request) {
                 alert('服务器正忙，请稍后再试');
                },
                success: function(data) {
                     if(data.data == 1) {
                         alert('数据不符合规范，请重新输入');
                     }
                     if(data.data == 0){
                         alert('修改成功！');
                         window.location.href="{% url 'user_info' user_id %}";
                     }
                     if(data.data == -1){
                         alert('您没有操作权限');
                     }
                }
             });
         });

        </script>
    {% endif %}

{% endblock %}


{% block user_course %}
    <h2>注册的课程</h2>
    {% for course in all_course %}
        <a href="{% url 'course_detail' course.course.id %}"> <p>课程名称：{{ course.course.name }}</p></a>
        <div>课程图片：{{ course.course.image }}</div>
        <div>课程进度：</div>
    {% endfor %}
{% endblock %}